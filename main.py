import telebot
from telebot import types

# Твій токен
API_TOKEN = '8196800585:AAE3UBIw9m37YRJnWBm220DNYs7KnPGa7Ro'

bot = telebot.TeleBot(API_TOKEN)

# Словник для збереження ID останнього повідомлення бота
users_last_msg = {}

def main_menu():
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=1)
    btn1 = types.KeyboardButton("ІСТОРИКО-ПРАВОВИЙ ПРОФІЛЬ")
    btn2 = types.KeyboardButton("ПРОФІЛЬ ІНОЗЕМНОЇ ФІЛОЛОГІЇ")
    btn3 = types.KeyboardButton("БІОТЕХНОЛОГІЧНИЙ ПРОФІЛЬ")
    btn4 = types.KeyboardButton("МЕДИЧНИЙ ПРОФІЛЬ")
    markup.add(btn1, btn2, btn3, btn4)
    return markup

def delete_messages(chat_id, user_msg_id):
    # 1. Видаляємо повідомлення користувача (натискання кнопки)
    try:
        bot.delete_message(chat_id, user_msg_id)
    except:
        pass

    # 2. Видаляємо попереднє повідомлення бота
    if chat_id in users_last_msg:
        try:
            bot.delete_message(chat_id, users_last_msg[chat_id])
        except:
            pass

# Команда /start
@bot.message_handler(commands=['start'])
def send_welcome(message):
    msg = bot.send_message(
        message.chat.id,
        "Вітаю! Оберіть профіль навчання за допомогою кнопок нижче:",
        reply_markup=main_menu()
    )

# Команда /help
@bot.message_handler(commands=['help'])
def help_command(message):
    help_text = (
        "*Допомога*\n\n"
        "Цей бот допоможе вам ознайомитися з профілями навчання в нашому закладі.\n\n"
        "— Використовуйте кнопки під полем вводу для навігації.\n"
        "— Якщо кнопки зникли, введіть /start.\n\n"
        "Якщо у вас виникли додаткові питання або бот працює некоректно, зверніться до адміністрації закладу."
    )
    bot.send_message(message.chat.id, help_text, parse_mode='Markdown')

# Універсальна функція відправки профілів
def send_profile_info(message, text_caption):
    # Видаляємо старе (своє і користувача)
    delete_messages(message.chat.id, message.message_id)

    try:
        with open('tnvk15.jpg', 'rb') as photo:
            sent_msg = bot.send_photo(
                message.chat.id, 
                photo, 
                caption=text_caption, 
                parse_mode='Markdown'
            )
            users_last_msg[message.chat.id] = sent_msg.message_id
    except FileNotFoundError:
        sent_msg = bot.send_message(message.chat.id, text_caption, parse_mode='Markdown')
        users_last_msg[message.chat.id] = sent_msg.message_id

# --- ОБРОБНИКИ КНОПОК ---

@bot.message_handler(func=lambda message: message.text == "ІСТОРИКО-ПРАВОВИЙ ПРОФІЛЬ")
def profile_history(message):
    text = (
        "*ІСТОРИКО-ПРАВОВИЙ ПРОФІЛЬ*\n\n"
        "*НАШ ВИПУСКНИК ЗНАТИМЕ*\n"
        "— Еволюцію правових систем від давніх цивілізацій до сучасних конституцій.\n"
        "— Ключові історичні події, що сформували правові норми.\n"
        "— Основи міжнародного права, включаючи таємні договори і конфлікти.\n"
        "— Роль лідерів у правовій історії.\n"
        "— Практичні аспекти роботи з архівною документацією.\n\n"
        "*ВМІТИМЕ*\n"
        "— Аналізувати історичні документи, розкриваючи приховані мотиви за рядками законів.\n"
        "— Аргументувати в дебатах, будуючи фортеці з фактів і прецедентів.\n"
        "— Досліджувати правові кейси як детектив, з’єднуючи нитки минулого з сьогоденням.\n"
        "— Створювати есе на історико-правові теми.\n"
        "— Застосовувати правові принципи в моделях.\n\n"
        "*ЗМОЖЕ*\n"
        "— Захищати права в реальному світі, перетворюючи знання на щит проти несправедливості.\n"
        "— Інноваційно вирішувати конфлікти, комбінуючи право з креативністю.\n"
        "— Лідирувати в правових ініціативах, перетворюючи ідеї на рушійну силу трансформацій.\n"
        "— Прийняти свідоме рішення у виборі майбутньої професії.\n"
        "— Підготуватися до якісного складання НМТ (ЗНО)."
    )
    send_profile_info(message, text)

@bot.message_handler(func=lambda message: message.text == "ПРОФІЛЬ ІНОЗЕМНОЇ ФІЛОЛОГІЇ")
def profile_philology(message):
    text = (
        "*ПРОФІЛЬ ІНОЗЕМНОЇ ФІЛОЛОГІЇ*\n\n"
        "*НАШ ВИПУСКНИК ЗНАТИМЕ*\n"
        "— Основну граматику (не нижче B1–B2).\n"
        "— Активну лексику та побудову тексту.\n"
        "— Культурні особливості та правила мовленнєвого етикету.\n"
        "— Цифровий етикет, норми спілкування в месенджерах та при роботі з ШІ.\n\n"
        "*ВМІТИМЕ*\n"
        "*Говорити:*\n"
        "— про себе, події, підтримати діалог, висловити думку.\n"
        "*Слухати:*\n"
        "— реальну англійську, німецьку, польську; розуміти почуте у медіа.\n"
        "*Читати:*\n"
        "— автентичні тексти без перекладача; вибирати потрібну інформацію.\n"
        "*Писати:*\n"
        "— листи, повідомлення, есе, пости для блогів.\n\n"
        "*ЗМОЖЕ*\n"
        "— Скласти резюме та мотиваційний лист.\n"
        "— Пройти співбесіду на базовому рівні.\n"
        "— Навчатися за іншомовними ресурсами.\n"
        "— Подорожувати без мовного бар’єра.\n"
        "— Аналізувати мовлення з погляду його доцільності.\n"
        "— Успішно скласти НМТ.\n"
        "— Аргументовано викладати думки та дискутувати."
    )
    send_profile_info(message, text)

@bot.message_handler(func=lambda message: message.text == "БІОТЕХНОЛОГІЧНИЙ ПРОФІЛЬ")
def profile_biotech(message):
    text = (
        "*БІОТЕХНОЛОГІЧНИЙ ПРОФІЛЬ*\n\n"
        "*НАШ ВИПУСКНИК ЗНАТИМЕ*\n"
        "— Особливості роботи програміста і математика: від ідеї до практичного застосування.\n"
        "— Логіку формул, конструювання моделей (GeoGebra).\n"
        "— Основи кібербезпеки та цифровий світ «під капотом».\n"
        "— Принципи успішної реалізації STEM-проєктів.\n\n"
        "*ВМІТИМЕ*\n"
        "— Аналізувати задачі, структурувати інформацію та обирати оптимальний шлях розв’язання.\n"
        "— Створювати алгоритми, проєктувати моделі та візуалізувати 3D продукти (Blender).\n"
        "— Знаходити помилки та вдосконалювати IT-рішення (цифровий аудит).\n\n"
        "*ЗМОЖЕ*\n"
        "— Створювати власні цифрові продукти від ідеї до результату.\n"
        "— Розв’язувати математичні задачі прикладного характеру.\n"
        "— Швидко опановувати нові технології (ШІ, IoT, AR/VR, Big Data).\n"
        "— Упевнено складати НМТ з математики без стресу.\n"
        "— Використовувати математику й інформатику для професійного зростання."
    )
    send_profile_info(message, text)

@bot.message_handler(func=lambda message: message.text == "МЕДИЧНИЙ ПРОФІЛЬ")
def profile_medical(message):
    text = (
        "*МЕДИЧНИЙ ПРОФІЛЬ*\n\n"
        "*НАШ ВИПУСКНИК ЗНАТИМЕ*\n"
        "— Основи біології, молекулярної медицини, генетики та фізіології.\n"
        "— Будову речовин, закони хімії та процеси перетворень.\n"
        "— Физичні принципи діагностики та лікування.\n\n"
        "*ВМІТИМЕ*\n"
        "— Працювати з лабораторним обладнанням.\n"
        "— Здійснювати якісний та кількісний аналіз речовин.\n\n"
        "*ЗМОЖЕ*\n"
        "— Аналізувати екологічні ризики та розвивати медицину.\n"
        "— Надавати першу домедичну допомогу.\n"
        "— Підготуватися до якісного складання НМТ."
    )
    send_profile_info(message, text)

# Обробник будь-якого іншого контенту (текст, фото, стікери тощо)
@bot.message_handler(content_types=['text', 'photo', 'video', 'sticker', 'video_note', 'voice', 'location', 'contact'])
def unknown_content(message):
    bot.reply_to(
        message, 
        "Вибачте, я не розумію цей запит. Будь ласка, скористайтеся кнопками меню.\n"
        "Якщо виникли проблеми, напишіть /help"
    )

# Запуск
if __name__ == '__main__':
    print("Бот працює...")
    bot.infinity_polling()